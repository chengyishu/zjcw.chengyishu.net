<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>资金管理与仓位控制</title>
    <link rel="icon" href="https://liyi.chengyishu.net/img/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    	table tbody th{width:0px;word-break: keep-all;text-align:right;}
    	th.bg{background-color:#f0f0f0;}
    </style>
  </head>
	<body class="pt-5">
		<div class="container">
			<h1 class="text-center">资金管理与仓位控制</h1>
			<div class="row">
				<div class="offset-md-2 col-md-8 offset-sm-1 col-sm-10">
					<!-- 输入本金 -->
					<div class="input-group my-3">
					  <span class="input-group-text">本金Ａ＝</span>
					  <input id="A" type="number" step="0.01" min="0" class="form-control" value="100000">
					</div>
					<div class="row">
						<!-- 输入备用金率 -->
						<div class="input-group mb-3 col">
						  <span class="input-group-text">备用金</span>
						  <input id="byj-rate" type="number" step="1" min="0" class="form-control text-center" value="10">
						  <span class="input-group-text">%</span>
						</div>
						<!-- 输入持仓比例 -->
						<div class="input-group mb-3 col">
						  <span class="input-group-text">控制</span>
						  <input id="pc-rate" type="number" step="1" min="0" class="form-control text-center" value="5">
						  <span class="input-group-text">成仓位</span>
						</div>
					</div>
					<!-- 资金部 -->
					<table class="table table-bordered table-hover">
						<thead>
							<tr>
								<th colspan="3" class="bg">资金部</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th colspan="2">开仓本金Ａ</th>
								<td>￥<span id="zjb-A"></span></td>
							</tr>
							<tr>
								<th colspan="2">可授权资金Ｂ</th>
								<td>￥<span id="zjb-B"></span></td>
							</tr>
							<tr>
								<th rowspan="2" style="vertical-align:middle;">银行账户</th>
								<th>可授权余额</th>
								<td>￥<span id="zjb-ksqye"></span></td>
							</tr>
							<tr>
								<th>备用金</th>
								<td>￥<span id="zjb-byj"></span></td>
							</tr>
						</tbody>
					</table>
					<!-- 授权部 -->
					<table class="table table-bordered table-hover">
						<thead>
							<tr>
								<th colspan="2" class="bg">授权部</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th>可支配资金Ｃ</th>
								<td>￥<span id="sqb-C"></span></td>
							</tr>
						</tbody>
					</table>
					<!-- 市场部 -->
					<table class="table table-bordered table-hover">
						<thead>
							<tr>
								<th colspan="3" class="bg">市场部</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th rowspan="2" style="vertical-align:middle;">证券账户</th>
								<th>账户资产</th>
								<td>￥<span id="scb-zhzc"></span></td>
							</tr>
							<tr>
								<th>可提现金</th>
								<td>￥<span id="scb-ktxj"></span></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>

	  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/zepto@1.2.0/dist/zepto.min.js"></script>
	  <script>
	  	$(function () {
	  		$('#A,#byj-rate,#pc-rate').on('input', function() {
	  			zjcw();
	  		});
	  		zjcw();
	  	});
	  	//计算相关数据
	  	function zjcw() {
	  		//本金
				let A = $('#A').val();
				if (!A) {
					A = 0;
				}
				//备用金率
				let byjRate = $('#byj-rate').val() / 100;
				if (!byjRate) {
					byjRate = 0;
				}
				//持仓比例
				let pcRate = $('#pc-rate').val() / 10;
				if (!pcRate) {
					pcRate = 0;
				}
				//执行计算
				ZJB(A, byjRate, pcRate);
				SQB(A, byjRate, pcRate);
				SCB(A, byjRate, pcRate);
	  	}
	  	//计算资金部
	  	function ZJB(A, byjRate, pcRate) {
	  		//计算公式
	  		let B = A*(1-byjRate);
	  		let ksqye = B*(1-pcRate);
	  		let byj = A*byjRate;
	  		//显示结果
	  		$('#zjb-A').text(round(A,2));
	  		$('#zjb-B').text(round(B,2));
	  		$('#zjb-ksqye').text(round(ksqye,2));
	  		$('#zjb-byj').text(round(byj,2));
	  	}
	  	//计算授权部
	  	function SQB(A, byjRate, pcRate) {
	  		//计算公式
	  		let C = A*(1-byjRate)*pcRate;
	  		//显示结果
	  		$('#sqb-C').text(round(C,2));
	  	}
	  	//计算市场部
	  	function SCB(A, byjRate, pcRate) {
	  		//计算公式
	  		let zhzc = A*(1-byjRate)*pcRate;
	  		let ktxj = zhzc;
	  		//显示结果
	  		$('#scb-zhzc').text(round(zhzc,2));
	  		$('#scb-ktxj').text(round(ktxj,2));
	  	}
	  	//四舍五入
	  	function round(number, decimal) {
	  		decimal += 1;
	  		number = Math.round(number*Math.pow(10,decimal))/Math.pow(10,decimal);
	  		decimal -= 1;
	  		number = Math.floor(number*Math.pow(10,decimal))/Math.pow(10,decimal);
	  		//补0
	  		numarray = number.toString().split('.');
	  		if (numarray.length > 1) {
	  			for (var i = 0; i < decimal - numarray[1].length; i++) {
	  				number = number.toString() + '0';
	  			}
	  		} else {
	  			number = number.toString() + '.';
	  			for (var i = 0; i < decimal; i++) {
	  				number = number.toString() + '0';
	  			}
	  		}
	  		return number_format(number*1);
	  	}
	  	//数字格式化
		 	function number_format(number, bit, sign, gapnum) {
	 	    //设置接收参数的默认值
	 	    var bit = arguments[1] ? arguments[1] : 2;
	 	    var sign = arguments[2] ? arguments[2] : ',';
	 	    var gapnum = arguments[3] ? arguments[3] : 3;
	 	    var str = '';
	 	    number = number.toFixed(bit); //格式化
	 	    realnum = number.split('.')[0]; //整数位(使用小数点分割整数和小数部分)
	 	    decimal = number.split('.')[1]; //小数位
	 	    realnumarr = realnum.split(''); //将整数位逐位放进数组 ["1", "2", "3", "4", "5", "6"]
	 	    //把整数部分从右往左拼接，每bit位添加一个sign符号
	 	    for (var i = 1; i <= realnumarr.length; i++) {
 	        str = realnumarr[realnumarr.length - i] + str;
 	        if (i % gapnum == 0) {
 	          str = sign + str; //每隔gapnum位前面加指定符号
 	        }
	 	    }
	 	    //当遇到 gapnum 的倍数的时候，会出现比如 ",123",这种情况，所以要去掉最前面的 sign
	 	    str = (realnum.length % gapnum == 0) ? str.substr(1) : str;
	 	    //重新拼接实数部分和小数位
	 	    realnum = str + '.' + decimal;
	 	    return realnum;
		 	}
	  </script>
	</body>
</html>